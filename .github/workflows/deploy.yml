name: Deploy mdBook

on:
  push:
    branches:
      - main  # Set this to your default branch name

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Setup mdBook
      uses: peaceiris/actions-mdbook@v1
      with:
        mdbook-version: 'latest'
    - run: mdbook build
    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        personal_token: ${{ secrets.MDBOOK_DEPLOY_TOKEN }}
        publish_dir: ./book
        publish_branch: gh-pages
        force_orphan: true  # This option forces GitHub to rebuild the page
    - name: Trigger GitHub Pages rebuild
      run: |
        curl -L \
          -X POST \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: token ${{ secrets.MDBOOK_DEPLOY_TOKEN }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/${{ github.repository }}/pages/builds